name: Test

on:
  push:
    branches: [ main, master, claude/** ]
  pull_request:
    branches: [ main, master ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'

    - name: Verificar estrutura do projeto
      run: |
        echo "üìÅ Verificando estrutura do projeto..."

        # Verificar arquivos principais
        if [ -f "index.html" ]; then
          echo "‚úÖ index.html encontrado"
        else
          echo "‚ùå index.html n√£o encontrado"
          exit 1
        fi

        if [ -f "manifest.json" ]; then
          echo "‚úÖ manifest.json encontrado"
        else
          echo "‚ùå manifest.json n√£o encontrado"
          exit 1
        fi

        if [ -d "src" ]; then
          echo "‚úÖ Diret√≥rio src encontrado"
        else
          echo "‚ùå Diret√≥rio src n√£o encontrado"
          exit 1
        fi

    - name: Validar arquivos JavaScript
      run: |
        echo "üîç Validando sintaxe JavaScript..."

        # Encontrar todos os arquivos .js
        JS_FILES=$(find . -name "*.js" -not -path "./node_modules/*" -not -path "./.git/*")

        if [ -z "$JS_FILES" ]; then
          echo "‚ö†Ô∏è  Nenhum arquivo JavaScript encontrado"
          exit 0
        fi

        # Usar Node.js para validar sintaxe b√°sica
        for file in $JS_FILES; do
          echo "Verificando: $file"
          node --check "$file" || exit 1
        done

        echo "‚úÖ Todos os arquivos JavaScript s√£o v√°lidos"

    - name: Validar HTML
      run: |
        echo "üîç Validando estrutura HTML..."

        # Verificar se index.html n√£o est√° vazio
        if [ -s "index.html" ]; then
          echo "‚úÖ index.html n√£o est√° vazio"

          # Verificar tags b√°sicas
          if grep -q "<html" index.html; then
            echo "‚úÖ Tag <html> encontrada"
          else
            echo "‚ö†Ô∏è  Tag <html> n√£o encontrada"
          fi

          if grep -q "<head" index.html; then
            echo "‚úÖ Tag <head> encontrada"
          else
            echo "‚ö†Ô∏è  Tag <head> n√£o encontrada"
          fi

          if grep -q "<body" index.html; then
            echo "‚úÖ Tag <body> encontrada"
          else
            echo "‚ö†Ô∏è  Tag <body> n√£o encontrada"
          fi
        else
          echo "‚ùå index.html est√° vazio"
          exit 1
        fi

    - name: Verificar configura√ß√£o do Supabase
      run: |
        echo "üîç Verificando arquivos de configura√ß√£o..."

        if [ -f "src/js/supabase.js" ]; then
          echo "‚úÖ supabase.js encontrado"
        else
          echo "‚ö†Ô∏è  supabase.js n√£o encontrado"
        fi

        if [ -f "src/js/config.js" ]; then
          echo "‚úÖ config.js encontrado"
        else
          echo "‚ö†Ô∏è  config.js n√£o encontrado"
        fi

    - name: Resultado final
      run: |
        echo ""
        echo "üéâ Todos os testes b√°sicos passaram!"
        echo "‚ú® O projeto est√° estruturado corretamente"
